<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- PWAë¥¼ ìœ„í•œ ë©”íƒ€ íƒœê·¸ ì¶”ê°€ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="/manifest.json">

    <title>Win-Win-Log: B2B ì˜ì—… í†µí•© ë‹¤ì´ì–´ë¦¬</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .container {
            max-width: 1024px;
        }
        .bg-card {
            background-color: #ffffff;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .nav-link {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .nav-link.active {
            color: #3b82f6;
            border-color: #3b82f6;
            font-weight: 600;
        }
        textarea.handwritten {
            font-family: 'Inter', sans-serif;
            line-height: 1.5;
            min-height: 200px;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .hidden {
            display: none;
        }
        #roi-page {
            min-height: 80vh;
        }
        .roi-input-field {
            margin-bottom: 1rem;
        }
        .roi-input-field label {
            font-weight: 500;
        }
        .roi-input-field input {
            width: 100%;
            padding: 0.5rem;
            border-radius: 0.5rem;
            border: 1px solid #d1d5db;
        }
        .chart-container {
            position: relative;
            height: 40vh;
            margin-bottom: 2rem;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
</head>
<body class="p-4 md:p-8">
    <!-- ë©”ì¸ ì•± ì»¨í…Œì´ë„ˆ -->
    <div id="main-app" class="container mx-auto">
        <!-- í—¤ë” ë° ë‚´ë¹„ê²Œì´ì…˜ -->
        <header class="flex flex-col md:flex-row items-center justify-between mb-8 md:mb-12">
            <h1 id="main-logo" class="text-3xl md:text-4xl font-bold text-gray-800 mb-4 md:mb-0 cursor-pointer">
                Win-Win-Log
            </h1>
            <!-- íƒ­ ë‚´ë¹„ê²Œì´ì…˜ -->
            <nav class="flex space-x-2 md:space-x-4">
                <a href="#" class="nav-link text-gray-500 px-4 py-2 border-b-2 border-transparent active" data-target="meeting-log">
                    <span class="text-sm md:text-lg">ë¯¸íŒ… ê¸°ë¡</span>
                </a>
                <a href="#" class="nav-link text-gray-500 px-4 py-2 border-b-2 border-transparent" data-target="records-list">
                    <span class="text-sm md:text-lg">ê¸°ë¡ ê´€ë¦¬</span>
                </a>
                <a href="#" class="nav-link text-gray-500 px-4 py-2 border-b-2 border-transparent" data-target="brainstorming">
                    <span class="text-sm md:text-lg">ë¸Œë ˆì¸ìŠ¤í† ë°</span>
                </a>
                <a href="#" class="nav-link text-gray-500 px-4 py-2 border-b-2 border-transparent" data-target="crm">
                    <span class="text-sm md:text-lg">ê³ ê° ê´€ê³„ë„</span>
                </a>
                <a href="#" class="nav-link text-gray-500 px-4 py-2 border-b-2 border-transparent" data-target="analysis">
                    <span class="text-sm md:text-lg">ì„±ê³µ/ì‹¤íŒ¨ ë¶„ì„</span>
                </a>
            </nav>
        </header>

        <!-- í…œí”Œë¦¿ ì½˜í…ì¸  ì„¹ì…˜ -->
        <main class="space-y-12">
            <!-- 1. ë¯¸íŒ… ê¸°ë¡ í…œí”Œë¦¿ (Create & Update) -->
            <section id="meeting-log" class="template-section bg-card p-6 md:p-12">
                <h2 class="text-2xl md:text-3xl font-bold mb-6 text-gray-800">ë¯¸íŒ… ê¸°ë¡</h2>
                <!-- í˜„ì¬ ìˆ˜ì • ì¤‘ì¸ ê¸°ë¡ì˜ IDë¥¼ ì €ì¥í•˜ëŠ” ìˆ¨ê¹€ í•„ë“œ -->
                <input type="hidden" id="current-record-id-meeting">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- ê¸°ë³¸ ì •ë³´ -->
                    <div class="bg-gray-50 p-6 rounded-2xl shadow-inner">
                        <div class="space-y-4">
                            <div>
                                <label for="client-name-meeting" class="block text-sm md:text-base font-medium text-gray-600">ê³ ê°ì‚¬ëª…</label>
                                <input type="text" id="client-name-meeting" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2" placeholder="ì˜ˆ: êµ¬ê¸€ ì½”ë¦¬ì•„">
                            </div>
                            <div>
                                <label for="contact-name-meeting" class="block text-sm md:text-base font-medium text-gray-600">ë‹´ë‹¹ì</label>
                                <input type="text" id="contact-name-meeting" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2" placeholder="ì˜ˆ: í™ê¸¸ë™ íŒ€ì¥">
                            </div>
                            <div>
                                <label for="author-name" class="block text-sm md:text-base font-medium text-gray-600">ì‘ì„±ì</label>
                                <input type="text" id="author-name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2" placeholder="ì˜ˆ: ê¹€ì§€í›ˆ">
                            </div>
                            <div>
                                <label for="meeting-date" class="block text-sm md:text-base font-medium text-gray-600">ë¯¸íŒ… ë‚ ì§œ</label>
                                <input type="date" id="meeting-date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2">
                            </div>
                            <div>
                                <label for="expected-deal" class="block text-sm md:text-base font-medium text-gray-600">ì˜ˆìƒ ê³„ì•½ ê¸ˆì•¡ (ë§Œì›)</label>
                                <input type="number" id="expected-deal" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2" placeholder="ì˜ˆ: 5000">
                            </div>
                            <div>
                                <label class="block text-sm md:text-base font-medium text-gray-600">ì˜ì—… ë‹¨ê³„</label>
                                <div class="mt-2 space-y-2">
                                    <label class="flex items-center"><input type="radio" name="sales-stage" value="discovery" class="mr-2 text-blue-500 focus:ring-blue-500" checked> Lead/Prospect (ì •ë³´ìˆ˜ì§‘)</label>
                                    <label class="flex items-center"><input type="radio" name="sales-stage" value="proposal" class="mr-2 text-blue-500 focus:ring-blue-500"> Proposal (ì œì•ˆ)</label>
                                    <label class="flex items-center"><input type="radio" name="sales-stage" value="closing" class="mr-2 text-blue-500 focus:ring-blue-500"> Closing (ê³„ì•½)</label>
                                </div>
                            </div>
                            <div class="stage-fields" data-stage="discovery proposal closing">
                                <label for="desired-system" class="block text-sm md:text-base font-medium text-gray-600">ì›í•˜ëŠ” ì‹œìŠ¤í…œ/ì†”ë£¨ì…˜</label>
                                <select id="desired-system" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2">
                                    <option value="">ì„ íƒ</option>
                                    <option value="MES">MES</option>
                                    <option value="EES">EES</option>
                                    <option value="EMS">EMS</option>
                                    <option value="QMS">QMS</option>
                                    <option value="SPC">SPC</option>
                                    <option value="TC">TC</option>
                                    <option value="AI">AI</option>
                                    <option value="DT">DT</option>
                                    <option value="APS">APS</option>
                                </select>
                            </div>
                            <div class="stage-fields" data-stage="discovery proposal closing">
                                <label for="implementation-timeline" class="block text-sm md:text-base font-medium text-gray-600">ë„ì… ì‹œì </label>
                                <select id="implementation-timeline" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2">
                                    <option value="">ì„ íƒ</option>
                                    <option value="1-3-months">1-3ê°œì›” ì´ë‚´</option>
                                    <option value="3-6-months">3-6ê°œì›” ì´ë‚´</option>
                                    <option value="6-12-months">6-12ê°œì›” ì´ë‚´</option>
                                    <option value="over-12-months">1ë…„ ì´ìƒ</option>
                                </select>
                            </div>
                            <!-- ì¶”ê°€ëœ í•„ë“œ -->
                            <div class="stage-fields" data-stage="discovery proposal closing">
                                <label for="decision-method" class="block text-sm md:text-base font-medium text-gray-600">ì˜ì‚¬ê²°ì • ë°©ì‹</label>
                                <select id="decision-method" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2">
                                    <option value="">ì„ íƒ</option>
                                    <option value="instant">ì¦‰ì‹œ ê²°ì •</option>
                                    <option value="upper-level">ìƒìœ„ ë³´ê³ </option>
                                    <option value="majority">ë‹¤ìˆ˜ê²° í˜‘ì˜</option>
                                    <option value="rfp">RFP/ì…ì°°</option>
                                </select>
                            </div>
                            <div class="mt-4 stage-fields" data-stage="discovery proposal closing">
                                <label class="block text-sm md:text-base font-medium text-gray-600 mb-2">ë¯¸íŒ… ë¶„ìœ„ê¸°</label>
                                <div class="flex flex-wrap space-x-4">
                                    <label class="flex items-center"><input type="checkbox" name="meeting-mood" value="positive" class="mr-2 text-green-500 focus:ring-green-500"> ê¸ì •ì </label>
                                    <label class="flex items-center"><input type="checkbox" name="meeting-mood" value="negative" class="mr-2 text-red-500 focus:ring-red-500"> ë¶€ì •ì </label>
                                    <label class="flex items-center"><input type="checkbox" name="meeting-mood" value="neutral" class="mr-2 text-gray-500 focus:ring-gray-500"> ì¤‘ë¦½ì </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ë¯¸íŒ… ë‚´ìš© -->
                    <div class="space-y-6">
                        <div class="stage-fields" data-stage="discovery proposal closing">
                            <label for="key-questions" class="block text-sm md:text-base font-medium text-gray-600">í•µì‹¬ ì§ˆë¬¸ ê¸°ë¡</label>
                            <textarea id="key-questions" rows="4" class="handwritten mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-4" placeholder="ê³ ê°ì—ê²Œ ë˜ì§„ í•µì‹¬ ì§ˆë¬¸ê³¼ ë‹µë³€ì„ ê¸°ë¡í•˜ì„¸ìš”. (ì˜ˆ: ê¸°ì¡´ ì‹œìŠ¤í…œì˜ ê°€ì¥ í° ë¶ˆë§Œì€ ë¬´ì—‡ì¸ê°€ìš”?)"></textarea>
                        </div>
                        <div class="stage-fields" data-stage="discovery proposal closing">
                            <label for="pain-point" class="block text-sm md:text-base font-medium text-gray-600">ê³ ê°ì˜ Pain Point (ê³ í†µì )</label>
                            <textarea id="pain-point" rows="4" class="handwritten mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-4" placeholder="ê³ ê°ì´ ê²ªê³  ìˆëŠ” í•µì‹¬ ë¬¸ì œë¥¼ ê¸°ë¡í•˜ì„¸ìš”."></textarea>
                        </div>
                        <div class="stage-fields" data-stage="discovery proposal closing">
                            <label for="needs" class="block text-sm md:text-base font-medium text-gray-600">ê³ ê°ì˜ Needs & Goals (ë‹ˆì¦ˆ ë° ëª©í‘œ)</label>
                            <textarea id="needs" rows="4" class="handwritten mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-4" placeholder="ê³ ê°ì´ ê¶ê·¹ì ìœ¼ë¡œ ì–»ê³  ì‹¶ì€ ê²ƒì„ ê¸°ë¡í•˜ì„¸ìš”."></textarea>
                        </div>
                        <div class="stage-fields hidden" data-stage="proposal closing">
                            <label for="proposal-details" class="block text-sm md:text-base font-medium text-gray-600">ì£¼ìš” ì œì•ˆ ë‚´ìš© ë° í˜‘ìƒ</label>
                            <textarea id="proposal-details" rows="4" class="handwritten mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-4" placeholder="ì œì•ˆí•œ ì†”ë£¨ì…˜ì˜ í•µì‹¬ê³¼ í˜‘ìƒ ê³¼ì •ì„ ê¸°ë¡í•˜ì„¸ìš”. (ì˜ˆ: ê°€ê²©, ê³„ì•½ ì¡°ê±´ ë“±)"></textarea>
                        </div>
                        <div class="stage-fields hidden" data-stage="proposal">
                            <label for="customer-objections" class="block text-sm md:text-base font-medium text-gray-600">ê³ ê°ì˜ ì£¼ìš” ë°˜ëŒ€ ì˜ê²¬</label>
                            <textarea id="customer-objections" rows="4" class="handwritten mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-4" placeholder="ê³ ê°ì˜ ë°˜ëŒ€ ì˜ê²¬ê³¼ ì´ì— ëŒ€í•œ í•´ê²° ë°©ì•ˆì„ ê¸°ë¡í•˜ì„¸ìš”."></textarea>
                        </div>
                        <div class="stage-fields hidden" data-stage="closing">
                            <label for="closing-outcome" class="block text-sm md:text-base font-medium text-gray-600">ê³„ì•½ ê²°ê³¼ ë° ìš”ì¸</label>
                            <textarea id="closing-outcome" rows="4" class="handwritten mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-4" placeholder="ê³„ì•½ì´ ì„±ê³µ ë˜ëŠ” ì‹¤íŒ¨í•œ ì´ìœ ë¥¼ ê¸°ë¡í•˜ì„¸ìš”."></textarea>
                        </div>
                        <div class="stage-fields" data-stage="discovery proposal closing">
                            <label for="competitor" class="block text-sm md:text-base font-medium text-gray-600">ê²½ìŸì‚¬ ê´€ë ¨ ì–¸ê¸‰</label>
                            <textarea id="competitor" rows="2" class="handwritten mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-4" placeholder="ê²½ìŸì‚¬ ì´ë¦„ ë° ê³ ê°ì˜ í‰ê°€ë¥¼ ê¸°ë¡í•˜ì„¸ìš”."></textarea>
                        </div>
                        <div class="stage-fields" data-stage="discovery proposal closing">
                            <label for="next-action" class="block text-sm md:text-base font-medium text-gray-600">Next Action Plan (ë‹¤ìŒ í–‰ë™ ê³„íš)</label>
                            <textarea id="next-action" rows="4" class="handwritten mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-4" placeholder="ë¯¸íŒ… í›„ í•´ì•¼ í•  êµ¬ì²´ì ì¸ í–‰ë™ì„ ê¸°ë¡í•˜ì„¸ìš”."></textarea>
                        </div>
                        <!-- ì¶”ê°€ëœ ììœ  ë©”ëª¨ í•„ë“œ -->
                        <div>
                            <label for="additional-notes" class="block text-sm md:text-base font-medium text-gray-600">ì¶”ê°€ ì •ë³´ / ììœ  ë©”ëª¨</label>
                            <textarea id="additional-notes" rows="4" class="handwritten mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-4" placeholder="êµ¬ë¶„ë˜ì§€ ì•Šì€ ê¸°íƒ€ ì¤‘ìš”í•œ ì •ë³´ë‚˜ ììœ ë¡­ê²Œ ë©”ëª¨í•  ë‚´ìš©ì„ ì‘ì„±í•˜ì„¸ìš”."></textarea>
                        </div>
                        <!-- ì²¨ë¶€íŒŒì¼ ì„¹ì…˜ ì¶”ê°€ -->
                        <div>
                            <label for="attachments" class="block text-sm md:text-base font-medium text-gray-600">ì²¨ë¶€íŒŒì¼</label>
                            <input type="file" id="attachments" multiple class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                            <div id="file-list-container" class="mt-2 space-y-1"></div>
                        </div>
                    </div>
                </div>
                <div class="flex justify-end mt-8">
                    <button id="save-btn-meeting" class="bg-blue-600 text-white font-semibold py-3 px-6 rounded-full shadow-lg hover:bg-blue-700 transition duration-300">
                        ë¯¸íŒ… ê¸°ë¡ ì €ì¥
                    </button>
                    <button id="new-record-btn-meeting" class="ml-4 bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-full shadow-lg hover:bg-gray-400 transition duration-300">
                        ìƒˆ ê¸°ë¡ ì‘ì„±
                    </button>
                </div>
            </section>
            
            <!-- 2. ê¸°ë¡ ê´€ë¦¬ íƒ­ (CRUD) -->
            <section id="records-list" class="template-section bg-card p-6 md:p-12 hidden">
                <h2 class="text-2xl md:text-3xl font-bold mb-6 text-gray-800">ê¸°ë¡ ê´€ë¦¬</h2>
                <div class="flex flex-wrap space-x-2 md:space-x-4 mb-8">
                    <button class="record-type-btn bg-blue-600 text-white font-semibold py-2 px-4 rounded-full" data-type="meeting">ë¯¸íŒ… ê¸°ë¡</button>
                    <button class="record-type-btn bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-full" data-type="brainstorming">ë¸Œë ˆì¸ìŠ¤í† ë°</button>
                    <button class="record-type-btn bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-full" data-type="crm">ê³ ê° ê´€ê³„ë„</button>
                    <button class="record-type-btn bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-full" data-type="analysis">ì„±ê³µ/ì‹¤íŒ¨ ë¶„ì„</button>
                </div>
                <button id="export-btn" class="bg-indigo-600 text-white font-semibold py-2 px-4 rounded-full shadow-lg hover:bg-indigo-700 transition duration-300 mb-6 hidden">
                    CSVë¡œ ë‚´ë³´ë‚´ê¸°
                </button>
                <div id="records-container" class="space-y-4">
                    <!-- ì €ì¥ëœ ê¸°ë¡ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
                <p id="no-records-message" class="text-gray-500 text-center mt-8 hidden">ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </section>

            <!-- 3. ë¸Œë ˆì¸ìŠ¤í† ë° í…œí”Œë¦¿ -->
            <section id="brainstorming" class="template-section bg-card p-6 md:p-12 hidden">
                <h2 class="text-2xl md:text-3xl font-bold mb-6 text-gray-800">ë¸Œë ˆì¸ìŠ¤í† ë°</h2>
                <input type="hidden" id="current-record-id-brainstorming">
                <div class="bg-gray-50 p-6 rounded-2xl shadow-inner mb-6">
                    <label for="client-name-brainstorming" class="block text-sm md:text-base font-medium text-gray-600">ê³ ê°ì‚¬ëª… (ì—°ê²°)</label>
                    <input type="text" id="client-name-brainstorming" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2" placeholder="ì˜ˆ: êµ¬ê¸€ ì½”ë¦¬ì•„">
                </div>
                <div class="space-y-6">
                    <div>
                        <h3 class="text-xl font-semibold mb-2 text-gray-700">ë¬¸ì œ ì •ì˜ & í•µì‹¬ ì§ˆë¬¸</h3>
                        <p class="text-gray-500 text-sm mb-4">í•´ê²°í•´ì•¼ í•  í•µì‹¬ ë¬¸ì œë¥¼ ëª…í™•íˆ ì •ì˜í•˜ê³ , ì•„ì´ë””ì–´ë¥¼ ë°œì‚°í•˜ê¸° ìœ„í•œ ì§ˆë¬¸ì„ ë˜ì§€ì„¸ìš”.</p>
                        <textarea id="problem-define" rows="3" class="handwritten mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-4" placeholder="ë¬¸ì œ: &#10;ì§ˆë¬¸:"></textarea>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold mb-2 text-gray-700">ì•„ì´ë””ì–´ ë°œì‚° (ë§ˆì¸ë“œë§µ)</h3>
                        <p class="text-gray-500 text-sm mb-4">ììœ ë¡­ê²Œ ì•„ì´ë””ì–´ë¥¼ ê¸°ë¡í•˜ê³ , ë§ˆì¸ë“œë§µì„ ê·¸ë¦¬ê±°ë‚˜ 5W1H ë°©ì‹ìœ¼ë¡œ ì‚¬ê³ ë¥¼ í™•ì¥í•˜ì„¸ìš”.</p>
                        <textarea id="ideas" rows="10" class="handwritten mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-4" placeholder="í•µì‹¬ ë¬¸ì œ &#10; â”œâ”€â”€ ì•„ì´ë””ì–´ 1 &#10; â”‚   â”œâ”€â”€ Why? &#10; â”‚   â””â”€â”€ How? &#10; â”œâ”€â”€ ì•„ì´ë””ì–´ 2 &#10; â””â”€â”€ ..."></textarea>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold mb-2 text-gray-700">SWOT ë¶„ì„</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-4 bg-white rounded-lg border">
                                <h4 class="font-bold mb-2 text-blue-600">ê°•ì  (Strengths)</h4>
                                <textarea id="swot-s" rows="3" class="w-full text-sm rounded-md border-gray-300 p-2" placeholder="ìš°ë¦¬ì˜ ê°•ì ì€?"></textarea>
                            </div>
                            <div class="p-4 bg-white rounded-lg border">
                                <h4 class="font-bold mb-2 text-red-600">ì•½ì  (Weaknesses)</h4>
                                <textarea id="swot-w" rows="3" class="w-full text-sm rounded-md border-gray-300 p-2" placeholder="ìš°ë¦¬ì˜ ì•½ì ì€?"></textarea>
                            </div>
                            <div class="p-4 bg-white rounded-lg border">
                                <h4 class="font-bold mb-2 text-green-600">ê¸°íšŒ (Opportunities)</h4>
                                <textarea id="swot-o" rows="3" class="w-full text-sm rounded-md border-gray-300 p-2" placeholder="ì‹œì¥ì˜ ê¸°íšŒëŠ”?"></textarea>
                            </div>
                            <div class="p-4 bg-white rounded-lg border">
                                <h4 class="font-bold mb-2 text-gray-600">ìœ„í˜‘ (Threats)</h4>
                                <textarea id="swot-t" rows="3" class="w-full text-sm rounded-md border-gray-300 p-2" placeholder="ê²½ìŸì‚¬/ì‹œì¥ ìœ„í˜‘ì€?"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex justify-end mt-8">
                    <button id="save-btn-brainstorming" class="bg-blue-600 text-white font-semibold py-3 px-6 rounded-full shadow-lg hover:bg-blue-700 transition duration-300">
                        ë¸Œë ˆì¸ìŠ¤í† ë° ì €ì¥
                    </button>
                    <button id="new-record-btn-brainstorming" class="ml-4 bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-full shadow-lg hover:bg-gray-400 transition duration-300">
                        ìƒˆ ê¸°ë¡ ì‘ì„±
                    </button>
                </div>
            </section>

            <!-- 4. ê³ ê° ê´€ê³„ë„ í…œí”Œë¦¿ -->
            <section id="crm" class="template-section bg-card p-6 md:p-12 hidden">
                <h2 class="text-2xl md:text-3xl font-bold mb-6 text-gray-800">ê³ ê° ê´€ê³„ë„</h2>
                <input type="hidden" id="current-record-id-crm">
                <div class="bg-gray-50 p-6 rounded-2xl shadow-inner mb-6">
                    <label for="client-name-crm" class="block text-sm md:text-base font-medium text-gray-600">ê³ ê°ì‚¬ëª… (ì—°ê²°)</label>
                    <input type="text" id="client-name-crm" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2" placeholder="ì˜ˆ: êµ¬ê¸€ ì½”ë¦¬ì•„">
                </div>
                <p class="text-gray-500 mb-6">ê³ ê°ì‚¬ ë‚´ ì£¼ìš” ì¸ë¬¼ë“¤ì˜ ì—­í• ê³¼ ê´€ê³„ë¥¼ ì‹œê°ì ìœ¼ë¡œ íŒŒì•…í•˜ì„¸ìš”.</p>
                <div id="crm-people-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- ì¸ë¬¼ ì¹´ë“œ í…œí”Œë¦¿ -->
                </div>
                <div class="flex justify-start mt-4">
                    <button id="add-person-btn-crm" class="bg-green-600 text-white font-semibold py-2 px-4 rounded-full shadow-md hover:bg-green-700 transition duration-300">
                        ì¸ë¬¼ ì¶”ê°€
                    </button>
                </div>
                <div class="flex justify-end mt-8">
                    <button id="save-btn-crm" class="bg-blue-600 text-white font-semibold py-3 px-6 rounded-full shadow-lg hover:bg-blue-700 transition duration-300">
                        ê³ ê° ê´€ê³„ë„ ì €ì¥
                    </button>
                    <button id="new-record-btn-crm" class="ml-4 bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-full shadow-lg hover:bg-gray-400 transition duration-300">
                        ìƒˆ ê¸°ë¡ ì‘ì„±
                    </button>
                </div>
            </section>
        
            <!-- 5. ì„±ê³µ/ì‹¤íŒ¨ ë¶„ì„ í…œí”Œë¦¿ -->
            <section id="analysis" class="template-section bg-card p-6 md:p-12 hidden">
                <h2 class="text-2xl md:text-3xl font-bold mb-6 text-gray-800">ì„±ê³µ/ì‹¤íŒ¨ ë¶„ì„</h2>
                <input type="hidden" id="current-record-id-analysis">
                <div class="bg-gray-50 p-6 rounded-2xl shadow-inner mb-6">
                    <label for="client-name-analysis" class="block text-sm md:text-base font-medium text-gray-600">ê³ ê°ì‚¬ëª… (ì—°ê²°)</label>
                    <input type="text" id="client-name-analysis" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2" placeholder="ì˜ˆ: êµ¬ê¸€ ì½”ë¦¬ì•„">
                </div>
                <div class="space-y-6">
                    <div>
                        <h3 class="text-xl font-semibold mb-2 text-gray-700">ì‚¬ë¡€ ê°œìš”</h3>
                        <p class="text-gray-500 text-sm mb-2">ì–´ë–¤ ìœ í˜•ì˜ ì‚¬ë¡€ì¸ì§€ ì„ íƒí•˜ì„¸ìš”.</p>
                        <div class="mt-2 space-x-4">
                            <label class="inline-flex items-center">
                                <input type="radio" name="case-type" value="success" class="case-type-radio text-blue-500 focus:ring-blue-500">
                                <span class="ml-2 text-sm md:text-base">ì„±ê³µ ì‚¬ë¡€</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="case-type" value="failure" class="case-type-radio text-blue-500 focus:ring-blue-500">
                                <span class="ml-2 text-sm md:text-base">ì‹¤íŒ¨ ì‚¬ë¡€</span>
                            </label>
                        </div>
                        <textarea id="case-summary" rows="3" class="handwritten mt-4 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-4" placeholder="ê³ ê°ì‚¬ëª…, ê³„ì•½ ê·œëª¨, ì£¼ìš” ì´ìŠˆë¥¼ ìš”ì•½í•˜ì„¸ìš”."></textarea>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold mb-2 text-gray-700">í•µì‹¬ ì›ì¸ ë¶„ì„</h3>
                        <p class="text-gray-500 text-sm mb-2">ì„±ê³µ ë˜ëŠ” ì‹¤íŒ¨ì— ê²°ì •ì ì¸ ì˜í–¥ì„ ë¯¸ì¹œ ìš”ì¸ë“¤ì„ ë¶„ì„í•˜ì„¸ìš”.</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <textarea id="my-action" rows="5" class="handwritten mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-4" placeholder="ë‚˜ì˜ í–‰ë™: ë‚´ê°€ ì˜í–ˆê±°ë‚˜ ë¶€ì¡±í–ˆë˜ ì ì€?"></textarea>
                            <textarea id="customer-side" rows="5" class="handwritten mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-4" placeholder="ê³ ê° ì¸¡ ìš”ì¸: ê³ ê°ì‚¬ì˜ ë‚´ë¶€/ì™¸ë¶€ í™˜ê²½ ë³€í™”ëŠ”?"></textarea>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold mb-2 text-gray-700">ì–»ì€ ì¸ì‚¬ì´íŠ¸</h3>
                        <p class="text-gray-500 text-sm mb-2">ì´ë²ˆ ì‚¬ë¡€ë¥¼ í†µí•´ ë°°ìš´ ê°€ì¥ ì¤‘ìš”í•œ êµí›ˆì€ ë¬´ì—‡ì¸ê°€ìš”?</p>
                        <textarea id="insight" rows="5" class="handwritten mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-4" placeholder="ë‹¤ìŒ ë²ˆì— ì ìš©í•  êµ¬ì²´ì ì¸ ì „ëµì´ë‚˜ êµí›ˆì„ ê¸°ë¡í•˜ì„¸ìš”."></textarea>
                    </div>
                </div>
                <div class="flex justify-end mt-8">
                    <button id="save-btn-analysis" class="bg-blue-600 text-white font-semibold py-3 px-6 rounded-full shadow-lg hover:bg-blue-700 transition duration-300">
                        ë¶„ì„ ê¸°ë¡ ì €ì¥
                    </button>
                    <button id="new-record-btn-analysis" class="ml-4 bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-full shadow-lg hover:bg-gray-400 transition duration-300">
                        ìƒˆ ê¸°ë¡ ì‘ì„±
                    </button>
                </div>
            </section>
        </main>
    </div>

    <!-- ROI ê³„ì‚° í˜ì´ì§€ -->
    <div id="roi-page" class="hidden fixed top-0 left-0 w-full h-full bg-gray-50 p-4 md:p-8 overflow-y-auto">
        <div class="container mx-auto">
            <header class="flex items-center justify-between mb-8">
                <button id="back-to-main-btn" class="text-gray-600 text-2xl font-bold hover:text-gray-900 transition-colors">&larr; ë’¤ë¡œê°€ê¸°</button>
                <h1 class="text-2xl md:text-3xl font-bold text-gray-800">ROI ê³„ì‚°ê¸°</h1>
            </header>
            <div class="bg-card p-6 md:p-12">
                <div class="mb-8">
                    <label for="roi-solution-select" class="block text-lg font-semibold text-gray-700 mb-2">ì†”ë£¨ì…˜ ì„ íƒ</label>
                    <select id="roi-solution-select" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 text-lg">
                        <option value="">ì†”ë£¨ì…˜ì„ ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="MES">MES</option>
                        <option value="EES">EES (ì„¤ë¹„ íš¨ìœ¨)</option>
                        <option value="EMS">EMS (ì„¤ë¹„ ë³´ì „)</option>
                        <option value="EAP">EAP (TC)</option>
                    </select>
                </div>

                <div id="roi-inputs" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 hidden">
                    <!-- ì…ë ¥ í•„ë“œê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>

                <!-- ë‹¤ë…„ ROI ê³„ì‚° ê¸°ê°„ ì…ë ¥ -->
                <div id="roi-period-input" class="mb-8 hidden">
                    <label for="calculation-period" class="block text-lg font-semibold text-gray-700 mb-2">ROI ê³„ì‚° ê¸°ê°„ (ë…„)</label>
                    <input type="number" id="calculation-period" value="5" min="1" max="10" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 text-lg">
                </div>
                
                <div id="roi-results" class="hidden">
                    <h3 class="text-2xl font-bold mb-4 text-gray-800">ROI ë¶„ì„ ê²°ê³¼</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-6">
                        <div>
                            <p class="text-gray-700 mb-2">ì´ íˆ¬ì ë¹„ìš©: <span id="roi-cost" class="font-bold text-blue-600">0ì›</span></p>
                            <p class="text-gray-700">ì—°ê°„ ì˜ˆìƒ ì ˆê° íš¨ê³¼: <span id="annual-savings" class="font-bold text-green-600">0ì›</span></p>
                            <p class="text-gray-700 mt-4 font-bold">íˆ¬ìê¸ˆ íšŒìˆ˜ ì‹œì : <span id="payback-period" class="text-indigo-600">ê³„ì‚° ì¤‘...</span></p>
                        </div>
                        <div class="bg-gray-100 p-4 rounded-xl flex flex-col justify-center items-center">
                            <p class="text-xl text-gray-700 font-semibold mb-1">ì´ ROI (<span id="roi-period-text">1ë…„</span>)</p>
                            <span id="final-roi" class="text-4xl font-extrabold text-indigo-600">0.00%</span>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="roiChart"></canvas>
                    </div>
                </div>

                <div class="flex justify-end mt-8">
                    <button id="calculate-roi-btn" class="bg-blue-600 text-white font-semibold py-3 px-6 rounded-full shadow-lg hover:bg-blue-700 transition duration-300">
                        ROI ê³„ì‚°
                    </button>
                    <button id="roi-reset-btn" class="ml-4 bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-full shadow-lg hover:bg-gray-400 transition duration-300">
                        ì´ˆê¸°í™”
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì¡°íšŒ ëª¨ë‹¬ -->
    <div id="view-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-2xl" onclick="closeModal()">
                &times;
            </button>
            <h3 class="text-2xl font-bold mb-4" id="modal-title"></h3>
            <div id="modal-details" class="space-y-4">
                <!-- ë™ì ìœ¼ë¡œ ë‚´ìš©ì´ ì±„ì›Œì§ˆ ì˜ì—­ -->
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Service Worker ë“±ë¡
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js').then(registration => {
                    console.log('Service Worker registered with scope:', registration.scope);
                }).catch(error => {
                    console.log('Service Worker registration failed:', error);
                });
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.template-section');
            const recordsContainer = document.getElementById('records-container');
            const noRecordsMessage = document.getElementById('no-records-message');
            const viewModal = document.getElementById('view-modal');
            const modalDetails = document.getElementById('modal-details');
            const modalTitle = document.getElementById('modal-title');
            const recordTypeBtns = document.querySelectorAll('.record-type-btn');
            const salesStageRadios = document.querySelectorAll('input[name="sales-stage"]');
            const exportBtn = document.getElementById('export-btn');
            const mainLogo = document.getElementById('main-logo');
            const mainApp = document.getElementById('main-app');
            const roiPage = document.getElementById('roi-page');
            const backToMainBtn = document.getElementById('back-to-main-btn');
            
            let currentRecordType = 'meeting'; // í˜„ì¬ ì„ íƒëœ ê¸°ë¡ íƒ€ì…
            let roiChart = null; // ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤

            // ROI ê³„ì‚°ì„ ìœ„í•œ ì…ë ¥ í•„ë“œ ë°ì´í„°
            const roiData = {
                MES: [
                    { label: "ìƒì‚° íš¨ìœ¨ ê°œì„ ìœ¨ (%)", key: "efficiency", value: 10, type: "number" },
                    { label: "ì›” ìƒì‚°ëŸ‰ (ë‹¨ìœ„)", key: "monthlyProduction", value: 10000, type: "number" },
                    { label: "ë‹¨ìœ„ ìƒì‚° ë¹„ìš© (ì›)", key: "unitCost", value: 500, type: "number" },
                    { label: "ì†”ë£¨ì…˜ ë„ì… ë¹„ìš© (ì›)", key: "solutionCost", value: 20000000, type: "number" },
                    { label: "ì—°ê°„ ìœ ì§€ë³´ìˆ˜ ë¹„ìš© (ì›)", key: "maintenanceCost", value: 3000000, type: "number" }
                ],
                EES: [
                    { label: "ì„¤ë¹„ ê°€ë™ë¥  ê°œì„ ìœ¨ (%)", key: "uptime", value: 5, type: "number" },
                    { label: "ì›” ê°€ë™ ì‹œê°„ (ì‹œê°„)", key: "monthlyUptime", value: 200, type: "number" },
                    { label: "ì‹œê°„ë‹¹ ìƒì‚°ëŸ‰ (ë‹¨ìœ„)", key: "hourlyProduction", value: 50, type: "number" },
                    { label: "ë‹¨ìœ„ ìƒì‚° ì´ìµ (ì›)", key: "unitProfit", value: 1000, type: "number" },
                    { label: "ì†”ë£¨ì…˜ ë„ì… ë¹„ìš© (ì›)", key: "solutionCost", value: 15000000, type: "number" },
                    { label: "ì—°ê°„ ìœ ì§€ë³´ìˆ˜ ë¹„ìš© (ì›)", key: "maintenanceCost", value: 2000000, type: "number" }
                ],
                EMS: [
                    { label: "ì˜ˆì§€ ë³´ì „ìœ¼ë¡œ ì¸í•œ ì ˆê° íš¨ê³¼ (%)", key: "maintenanceSavings", value: 15, type: "number" },
                    { label: "ì—°ê°„ ë³´ì „ ë¹„ìš© (ì›)", key: "annualMaintenanceCost", value: 50000000, type: "number" },
                    { label: "ì†”ë£¨ì…˜ ë„ì… ë¹„ìš© (ì›)", key: "solutionCost", value: 25000000, type: "number" },
                    { label: "ì—°ê°„ ìœ ì§€ë³´ìˆ˜ ë¹„ìš© (ì›)", key: "maintenanceCost", value: 4000000, type: "number" }
                ],
                EAP: [
                    { label: "TC ê°œì„ ìœ¨ (%)", key: "tcImprovement", value: 10, type: "number" },
                    { label: "ì—°ê°„ TC ì§€ì¶œ ë¹„ìš© (ì›)", key: "annualTcCost", value: 30000000, type: "number" },
                    { label: "ì†”ë£¨ì…˜ ë„ì… ë¹„ìš© (ì›)", key: "solutionCost", value: 10000000, type: "number" },
                    { label: "ì—°ê°„ ìœ ì§€ë³´ìˆ˜ ë¹„ìš© (ì›)", key: "maintenanceCost", value: 1500000, type: "number" }
                ]
            };

            const forms = {
                meeting: {
                    id: document.getElementById('current-record-id-meeting'),
                    inputs: {
                        clientName: document.getElementById('client-name-meeting'),
                        contactName: document.getElementById('contact-name-meeting'),
                        authorName: document.getElementById('author-name'),
                        meetingDate: document.getElementById('meeting-date'),
                        expectedDeal: document.getElementById('expected-deal'),
                        salesStage: salesStageRadios,
                        desiredSystem: document.getElementById('desired-system'),
                        implementationTimeline: document.getElementById('implementation-timeline'),
                        decisionMethod: document.getElementById('decision-method'),
                        meetingMood: document.querySelectorAll('input[name="meeting-mood"]'),
                        keyQuestions: document.getElementById('key-questions'),
                        painPoint: document.getElementById('pain-point'),
                        needs: document.getElementById('needs'),
                        competitor: document.getElementById('competitor'),
                        nextAction: document.getElementById('next-action'),
                        additionalNotes: document.getElementById('additional-notes'),
                        proposalDetails: document.getElementById('proposal-details'),
                        customerObjections: document.getElementById('customer-objections'),
                        closingOutcome: document.getElementById('closing-outcome'),
                        attachments: document.getElementById('attachments'),
                        fileList: document.getElementById('file-list-container')
                    },
                    saveBtn: document.getElementById('save-btn-meeting'),
                    newBtn: document.getElementById('new-record-btn-meeting')
                },
                brainstorming: {
                    id: document.getElementById('current-record-id-brainstorming'),
                    inputs: {
                        clientName: document.getElementById('client-name-brainstorming'),
                        problemDefine: document.getElementById('problem-define'),
                        ideas: document.getElementById('ideas'),
                        swotS: document.getElementById('swot-s'),
                        swotW: document.getElementById('swot-w'),
                        swotO: document.getElementById('swot-o'),
                        swotT: document.getElementById('swot-t')
                    },
                    saveBtn: document.getElementById('save-btn-brainstorming'),
                    newBtn: document.getElementById('new-record-btn-brainstorming')
                },
                crm: {
                    id: document.getElementById('current-record-id-crm'),
                    inputs: {
                        clientName: document.getElementById('client-name-crm'),
                        people: document.getElementById('crm-people-container')
                    },
                    addBtn: document.getElementById('add-person-btn-crm'),
                    saveBtn: document.getElementById('save-btn-crm'),
                    newBtn: document.getElementById('new-record-btn-crm')
                },
                analysis: {
                    id: document.getElementById('current-record-id-analysis'),
                    inputs: {
                        clientName: document.getElementById('client-name-analysis'),
                        caseType: document.querySelectorAll('input[name="case-type"]'),
                        caseSummary: document.getElementById('case-summary'),
                        myAction: document.getElementById('my-action'),
                        customerSide: document.getElementById('customer-side'),
                        insight: document.getElementById('insight')
                    },
                    saveBtn: document.getElementById('save-btn-analysis'),
                    newBtn: document.getElementById('new-record-btn-analysis')
                }
            };
            
            // ì˜ì—… ë‹¨ê³„ì— ë”°ë¼ í¼ í•„ë“œ ë™ì ìœ¼ë¡œ ë³€ê²½
            salesStageRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    updateMeetingFormFields(radio.value);
                });
            });

            // ì´ˆê¸° ë¡œë“œ ì‹œ í¼ í•„ë“œ ì„¤ì •
            updateMeetingFormFields(document.querySelector('input[name="sales-stage"][value="discovery"]').value);
            
            function updateMeetingFormFields(stage) {
                const allFields = document.querySelectorAll('#meeting-log .stage-fields');
                allFields.forEach(field => {
                    const stages = field.dataset.stage.split(' ');
                    if (stages.includes(stage)) {
                        field.classList.remove('hidden');
                    } else {
                        field.classList.add('hidden');
                    }
                });
            }


            // íƒ­ ì „í™˜ ë¡œì§
            navLinks.forEach(link => {
                link.addEventListener('click', (event) => {
                    event.preventDefault();
                    navLinks.forEach(item => item.classList.remove('active'));
                    event.currentTarget.classList.add('active');
                    sections.forEach(section => section.classList.add('hidden'));
                    const targetId = event.currentTarget.getAttribute('data-target');
                    document.getElementById(targetId).classList.remove('hidden');

                    if (targetId === 'records-list') {
                        loadRecordsList(currentRecordType);
                    } else if (targetId === 'crm') {
                        clearForm('crm');
                    } else {
                        clearForm(targetId.replace('-log', '')); // í¼ ì´ˆê¸°í™”
                    }
                });
            });
            
            // Win-Win-Log ë¡œê³  í´ë¦­ ì´ë²¤íŠ¸ (ROI í˜ì´ì§€ ì „í™˜)
            mainLogo.addEventListener('click', () => {
                mainApp.classList.add('hidden');
                roiPage.classList.remove('hidden');
            });
            
            // ROI í˜ì´ì§€ì—ì„œ ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
            backToMainBtn.addEventListener('click', () => {
                mainApp.classList.remove('hidden');
                roiPage.classList.add('hidden');
                // ROI ê³„ì‚°ê¸° ì´ˆê¸°í™”
                document.getElementById('roi-solution-select').value = '';
                document.getElementById('roi-inputs').innerHTML = '';
                document.getElementById('roi-inputs').classList.add('hidden');
                document.getElementById('roi-results').classList.add('hidden');
            });


            // ê¸°ë¡ íƒ€ì… ë²„íŠ¼ í´ë¦­ ë¡œì§
            recordTypeBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    recordTypeBtns.forEach(b => {
                        b.classList.remove('bg-blue-600', 'text-white');
                        b.classList.add('bg-gray-300', 'text-gray-800');
                    });
                    btn.classList.remove('bg-gray-300', 'text-gray-800');
                    btn.classList.add('bg-blue-600', 'text-white');
                    currentRecordType = btn.dataset.type;
                    loadRecordsList(currentRecordType);
                });
            });

            // ì¸ë¬¼ ì¶”ê°€ ë²„íŠ¼ ì´ë²¤íŠ¸ (CRM)
            forms.crm.addBtn.addEventListener('click', () => {
                addPersonCard();
            });

            // ì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            forms.meeting.saveBtn.addEventListener('click', () => saveForm('meeting'));
            forms.meeting.newBtn.addEventListener('click', () => clearForm('meeting'));

            forms.brainstorming.saveBtn.addEventListener('click', () => saveForm('brainstorming'));
            forms.brainstorming.newBtn.addEventListener('click', () => clearForm('brainstorming'));

            forms.crm.saveBtn.addEventListener('click', () => saveForm('crm'));
            forms.crm.newBtn.addEventListener('click', () => clearForm('crm'));

            forms.analysis.saveBtn.addEventListener('click', () => saveForm('analysis'));
            forms.analysis.newBtn.addEventListener('click', () => clearForm('analysis'));
            
            // Export ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            exportBtn.addEventListener('click', () => {
                exportToCsv(currentRecordType);
            });

            // ì¸ë¬¼ ì¹´ë“œ ìƒì„± í•¨ìˆ˜
            function createPersonCardHtml(person = {}) {
                const icon = person.name === 'ì˜ì‚¬ê²°ì •ê¶Œì (Decision Maker)' ? 'ğŸ‘‘' : person.name === 'ë‚´ë¶€ ì±”í”¼ì–¸ (Champion)' ? 'ğŸ’¡' : person.name === 'ì˜í–¥ë ¥ í–‰ì‚¬ì (Influencer)' ? 'ğŸ—£ï¸' : person.name === 'ì ì¬ì  ë°˜ëŒ€ì (Blocker)' ? 'ğŸš§' : 'ğŸ‘¤';
                const namePlaceholder = person.name || '';
                const titlePlaceholder = person.title || '';
                const rolePlaceholder = person.role || '';
                
                return `
                    <div class="bg-gray-50 p-4 rounded-2xl shadow-inner border border-gray-200 relative">
                        <button class="delete-person-btn absolute top-2 right-2 text-gray-400 hover:text-red-500 transition-colors" onclick="this.closest('.bg-gray-50').remove()">&times;</button>
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="text-xl">${icon}</span>
                            <input type="text" class="person-name w-full text-lg font-bold p-1 rounded-md border-gray-300 focus:border-blue-500" placeholder="ì¸ë¬¼ ì´ë¦„" value="${namePlaceholder}">
                        </div>
                        <input type="text" class="person-title w-full text-sm p-1 rounded-md border-gray-300 focus:border-blue-500" placeholder="ì§ìœ„" value="${titlePlaceholder}">
                        <textarea rows="2" class="person-role w-full mt-2 text-sm p-1 rounded-md border-gray-300 focus:border-blue-500" placeholder="ì—­í• ê³¼ í•µì‹¬ ê´€ì‹¬ì‚¬">${rolePlaceholder}</textarea>
                    </div>
                `;
            }

            // ì¸ë¬¼ ì¹´ë“œ ì¶”ê°€ í•¨ìˆ˜
            function addPersonCard(person = {}) {
                const container = forms.crm.inputs.people;
                container.insertAdjacentHTML('beforeend', createPersonCardHtml(person));
            }
            
            // CRM í¼ì˜ ì´ˆê¸°í™” í•¨ìˆ˜ë¥¼ ë³„ë„ë¡œ ì •ì˜
            function initializeCrmForm() {
                const container = forms.crm.inputs.people;
                container.innerHTML = ''; // ê¸°ì¡´ ì¹´ë“œ ëª¨ë‘ ì‚­ì œ
                // ê¸°ë³¸ ì¹´ë“œ 4ê°œ ìƒì„±
                addPersonCard({ name: "ì˜ì‚¬ê²°ì •ê¶Œì (Decision Maker)", title: "ì§ìœ„", role: "í•µì‹¬ ì—­í• ê³¼ ê´€ì‹¬ì‚¬" });
                addPersonCard({ name: "ë‚´ë¶€ ì±”í”¼ì–¸ (Champion)", title: "ì§ìœ„", role: "ìš°ë¦¬ í¸ì— ì„œ ìˆëŠ” ì´ìœ ì™€ í˜‘ë ¥ ë°©ì•ˆ" });
                addPersonCard({ name: "ì˜í–¥ë ¥ í–‰ì‚¬ì (Influencer)", title: "ì§ìœ„", role: "ê·¸ë“¤ì˜ ì˜ê²¬ì´ ì˜ì‚¬ê²°ì •ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ë ¥" });
                addPersonCard({ name: "ì ì¬ì  ë°˜ëŒ€ì (Blocker)", title: "ì§ìœ„", role: "ë°˜ëŒ€ ì´ìœ ì™€ ìš°ë ¤ ì‚¬í•­" });
                
                forms.crm.id.value = '';
                forms.crm.inputs.clientName.value = '';
            }

            // í¼ ë°ì´í„° ìˆ˜ì§‘ ë° ì €ì¥
            function saveForm(type) {
                const data = collectFormData(type);
                if (data) {
                    saveRecord(data, type);
                    alert('ê¸°ë¡ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    clearForm(type);
                    document.querySelector('[data-target="records-list"]').click();
                    loadRecordsList(type);
                } else {
                    alert('í•„ìˆ˜ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                }
            }

            // ë°ì´í„° ìˆ˜ì§‘ í•¨ìˆ˜
            function collectFormData(type) {
                const form = forms[type];
                const id = form.id.value || Date.now().toString();
                let data = { id: id, type: type, timestamp: new Date().toISOString() };

                if (type === 'meeting') {
                    if (!form.inputs.clientName.value.trim() || !form.inputs.contactName.value.trim()) return null;
                    data.clientName = form.inputs.clientName.value.trim();
                    data.contactName = form.inputs.contactName.value.trim();
                    data.authorName = form.inputs.authorName.value.trim();
                    data.meetingDate = form.inputs.meetingDate.value;
                    data.expectedDeal = form.inputs.expectedDeal.value;
                    data.salesStage = Array.from(form.inputs.salesStage).find(radio => radio.checked)?.value || '';
                    data.desiredSystem = form.inputs.desiredSystem.value;
                    data.implementationTimeline = form.inputs.implementationTimeline.value;
                    data.decisionMethod = form.inputs.decisionMethod.value;
                    data.meetingMood = Array.from(form.inputs.meetingMood).filter(checkbox => checkbox.checked).map(checkbox => checkbox.value);
                    data.keyQuestions = form.inputs.keyQuestions.value;
                    data.painPoint = form.inputs.painPoint.value;
                    data.needs = form.inputs.needs.value;
                    data.competitor = form.inputs.competitor.value;
                    data.nextAction = form.inputs.nextAction.value;
                    data.proposalDetails = form.inputs.proposalDetails.value;
                    data.customerObjections = form.inputs.customerObjections.value;
                    data.closingOutcome = form.inputs.closingOutcome.value;
                    data.additionalNotes = form.inputs.additionalNotes.value;
                    // ì²¨ë¶€íŒŒì¼ ì´ë¦„ ëª©ë¡ ì €ì¥ (íŒŒì¼ ë°ì´í„°ëŠ” ì €ì¥í•˜ì§€ ì•ŠìŒ)
                    data.attachments = Array.from(form.inputs.attachments.files).map(file => file.name);

                } else if (type === 'brainstorming') {
                    if (!form.inputs.clientName.value.trim() || !form.inputs.problemDefine.value.trim()) return null;
                    data.clientName = form.inputs.clientName.value.trim();
                    data.problemDefine = form.inputs.problemDefine.value;
                    data.ideas = form.inputs.ideas.value;
                    data.swotS = form.inputs.swotS.value;
                    data.swotW = form.inputs.swotW.value;
                    data.swotO = form.inputs.swotO.value;
                    data.swotT = form.inputs.swotT.value;
                } else if (type === 'crm') {
                    if (!form.inputs.clientName.value.trim()) return null;
                    data.clientName = form.inputs.clientName.value.trim();
                    const peopleData = [];
                    const personCards = form.inputs.people.querySelectorAll('.bg-gray-50');
                    personCards.forEach(card => {
                        const person = {
                            name: card.querySelector('.person-name').value,
                            title: card.querySelector('.person-title').value,
                            role: card.querySelector('.person-role').value
                        };
                        peopleData.push(person);
                    });
                    data.people = peopleData;
                } else if (type === 'analysis') {
                    if (!form.inputs.clientName.value.trim() || !form.inputs.caseSummary.value.trim()) return null;
                    data.clientName = form.inputs.clientName.value.trim();
                    data.caseType = Array.from(form.inputs.caseType).find(radio => radio.checked)?.value || '';
                    data.caseSummary = form.inputs.caseSummary.value;
                    data.myAction = form.inputs.myAction.value;
                    data.customerSide = form.inputs.customerSide.value;
                    data.insight = form.inputs.insight.value;
                }
                return data;
            }

            // í¼ í•„ë“œ ì´ˆê¸°í™”
            function clearForm(type) {
                const form = forms[type];
                form.id.value = '';
                if (type === 'meeting') {
                    form.inputs.clientName.value = '';
                    form.inputs.contactName.value = '';
                    form.inputs.authorName.value = '';
                    form.inputs.meetingDate.value = '';
                    form.inputs.expectedDeal.value = '';
                    form.inputs.salesStage.forEach(radio => radio.checked = false);
                    form.inputs.desiredSystem.value = '';
                    form.inputs.implementationTimeline.value = '';
                    form.inputs.decisionMethod.value = '';
                    form.inputs.meetingMood.forEach(checkbox => checkbox.checked = false);
                    form.inputs.keyQuestions.value = '';
                    form.inputs.painPoint.value = '';
                    form.inputs.needs.value = '';
                    form.inputs.competitor.value = '';
                    form.inputs.nextAction.value = '';
                    form.inputs.proposalDetails.value = '';
                    form.inputs.customerObjections.value = '';
                    form.inputs.closingOutcome.value = '';
                    form.inputs.additionalNotes.value = '';
                    forms.meeting.inputs.attachments.value = ''; // íŒŒì¼ ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                    forms.meeting.inputs.fileList.innerHTML = ''; // íŒŒì¼ ëª©ë¡ ì´ˆê¸°í™”
                    // ì´ˆê¸° ìƒíƒœë¡œ UI ì—…ë°ì´íŠ¸
                    document.querySelector('input[name="sales-stage"][value="discovery"]').checked = true;
                    updateMeetingFormFields('discovery');
                } else if (type === 'crm') {
                    initializeCrmForm();
                } else {
                    form.inputs.clientName.value = '';
                    for (const key in form.inputs) {
                        if (form.inputs[key] instanceof NodeList) {
                            form.inputs[key].forEach(radio => radio.checked = false);
                        } else if (typeof form.inputs[key] === 'object' && form.inputs[key].value !== undefined) {
                            form.inputs[key].value = '';
                        }
                    }
                }
            }

            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ë°ì´í„° ì €ì¥/ì—…ë°ì´íŠ¸
            function saveRecord(data, type) {
                const key = `b2b-${type}-records`;
                let records = JSON.parse(localStorage.getItem(key)) || {};
                records[data.id] = data;
                localStorage.setItem(key, JSON.stringify(records));
            }

            // ê¸°ë¡ ëª©ë¡ì„ í™”ë©´ì— í‘œì‹œ
            function loadRecordsList(type) {
                recordsContainer.innerHTML = '';
                const key = `b2b-${type}-records`;
                const records = JSON.parse(localStorage.getItem(key)) || {};
                const recordKeys = Object.keys(records).sort((a, b) => new Date(records[b].timestamp) - new Date(records[a].timestamp));

                if (recordKeys.length === 0) {
                    noRecordsMessage.classList.remove('hidden');
                    exportBtn.classList.add('hidden');
                } else {
                    noRecordsMessage.classList.add('hidden');
                    exportBtn.classList.remove('hidden');
                    recordKeys.forEach(key => {
                        const record = records[key];
                        const recordItem = document.createElement('div');
                        recordItem.className = 'flex flex-col md:flex-row items-start md:items-center justify-between bg-gray-100 p-4 rounded-xl shadow-sm border border-gray-200';
                        
                        let title = '';
                        let subInfo = `ì‘ì„±ì¼: ${new Date(record.timestamp).toLocaleDateString()}`;

                        if (type === 'meeting') {
                            title = `${record.clientName} - ${record.contactName}`;
                            subInfo += ` | ì‘ì„±ì: ${record.authorName || 'ë¯¸ìƒ'}`;
                        } else if (type === 'brainstorming') {
                            title = `ë¸Œë ˆì¸ìŠ¤í† ë°: ${record.clientName}`;
                        } else if (type === 'crm') {
                            title = `ê³ ê° ê´€ê³„ë„: ${record.clientName}`;
                        } else if (type === 'analysis') {
                            title = `ë¶„ì„: ${record.clientName}`;
                        }
                        
                        recordItem.innerHTML = `
                            <div>
                                <h4 class="font-bold text-lg text-gray-800">${title}</h4>
                                <p class="text-sm text-gray-500">${subInfo}</p>
                            </div>
                            <div class="mt-4 md:mt-0 md:ml-4 flex space-x-2">
                                <button class="view-btn bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-600 transition" data-id="${record.id}" data-type="${type}">ìƒì„¸ ë³´ê¸°</button>
                                <button class="edit-btn bg-yellow-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-yellow-600 transition" data-id="${record.id}" data-type="${type}">ìˆ˜ì •</button>
                                <button class="delete-btn bg-red-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-600 transition" data-id="${record.id}" data-type="${type}">ì‚­ì œ</button>
                            </div>
                        `;
                        recordsContainer.appendChild(recordItem);
                    });

                    // ë™ì ìœ¼ë¡œ ìƒì„±ëœ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                    document.querySelectorAll('.view-btn').forEach(button => {
                        button.addEventListener('click', (event) => showDetailsModal(event.target.dataset.id, event.target.dataset.type));
                    });
                    document.querySelectorAll('.edit-btn').forEach(button => {
                        button.addEventListener('click', (event) => {
                            loadRecord(event.target.dataset.id, event.target.dataset.type);
                            document.querySelector(`[data-target="${event.target.dataset.type}"]`).click();
                        });
                    });
                    document.querySelectorAll('.delete-btn').forEach(button => {
                        button.addEventListener('click', (event) => {
                            if (confirm('ì •ë§ë¡œ ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                                deleteRecord(event.target.dataset.id, event.target.dataset.type);
                                loadRecordsList(event.target.dataset.type);
                            }
                        });
                    });
                }
            }

            // íŠ¹ì • ê¸°ë¡ì„ í¼ì— ë¶ˆëŸ¬ì˜¤ê¸° (ìˆ˜ì • ê¸°ëŠ¥)
            function loadRecord(id, type) {
                const key = `b2b-${type}-records`;
                const records = JSON.parse(localStorage.getItem(key));
                if (records && records[id]) {
                    const data = records[id];
                    const form = forms[type];
                    form.id.value = data.id;
                    if (type === 'meeting') {
                        form.inputs.clientName.value = data.clientName;
                        form.inputs.contactName.value = data.contactName;
                        form.inputs.authorName.value = data.authorName;
                        form.inputs.meetingDate.value = data.meetingDate;
                        form.inputs.expectedDeal.value = data.expectedDeal;
                        form.inputs.salesStage.forEach(radio => radio.checked = radio.value === data.salesStage);
                        form.inputs.desiredSystem.value = data.desiredSystem;
                        form.inputs.implementationTimeline.value = data.implementationTimeline;
                        form.inputs.decisionMethod.value = data.decisionMethod;
                        form.inputs.meetingMood.forEach(checkbox => checkbox.checked = data.meetingMood.includes(checkbox.value));
                        form.inputs.keyQuestions.value = data.keyQuestions;
                        form.inputs.painPoint.value = data.painPoint;
                        form.inputs.needs.value = data.needs;
                        form.inputs.competitor.value = data.competitor;
                        form.inputs.nextAction.value = data.nextAction;
                        form.inputs.proposalDetails.value = data.proposalDetails;
                        form.inputs.customerObjections.value = data.customerObjections;
                        form.inputs.closingOutcome.value = data.closingOutcome;
                        form.inputs.additionalNotes.value = data.additionalNotes;
                        
                        // ì²¨ë¶€íŒŒì¼ ëª©ë¡ ë¡œë“œ (íŒŒì¼ì€ ë¡œì»¬ì— ì—†ìœ¼ë¯€ë¡œ ì´ë¦„ë§Œ í‘œì‹œ)
                        form.inputs.fileList.innerHTML = '';
                        if (data.attachments && data.attachments.length > 0) {
                            data.attachments.forEach(fileName => {
                                const fileItem = document.createElement('div');
                                fileItem.className = 'text-sm text-gray-600';
                                fileItem.innerText = `ğŸ“ ${fileName}`;
                                form.inputs.fileList.appendChild(fileItem);
                            });
                        }
                        updateMeetingFormFields(data.salesStage);
                    } else if (type === 'crm') {
                        form.inputs.clientName.value = data.clientName;
                        form.inputs.people.innerHTML = '';
                        data.people.forEach(person => addPersonCard(person));
                    } else {
                        form.inputs.clientName.value = data.clientName;
                        for (const key in form.inputs) {
                            if (form.inputs[key] instanceof NodeList) {
                                form.inputs[key].forEach(radio => radio.checked = radio.value === data[key]);
                            } else if (typeof form.inputs[key] === 'object' && form.inputs[key].value !== undefined) {
                                form.inputs[key].value = data[key];
                            }
                        }
                    }
                }
            }

            // íŠ¹ì • ê¸°ë¡ì„ ì‚­ì œ
            function deleteRecord(id, type) {
                const key = `b2b-${type}-records`;
                const records = JSON.parse(localStorage.getItem(key));
                if (records && records[id]) {
                    delete records[id];
                    localStorage.setItem(key, JSON.stringify(records));
                    alert('ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            }

            // ìƒì„¸ ë³´ê¸° ëª¨ë‹¬ í‘œì‹œ
            function showDetailsModal(id, type) {
                const key = `b2b-${type}-records`;
                const records = JSON.parse(localStorage.getItem(key));
                const data = records[id];
                if (data) {
                    modalDetails.innerHTML = '';
                    if (type === 'meeting') {
                        modalTitle.innerText = `ë¯¸íŒ… ê¸°ë¡: ${data.clientName}`;
                        const attachmentsHtml = data.attachments && data.attachments.length > 0 ?
                            `
                            <h4 class="font-bold text-gray-700 mb-2 mt-4">ì²¨ë¶€íŒŒì¼</h4>
                            <ul class="list-disc list-inside space-y-1">
                                ${data.attachments.map(file => `<li><a href="#" class="text-blue-600 hover:underline" onclick="event.preventDefault(); alert('ì´ ê¸°ëŠ¥ì€ ì‹¤ì œ ì„œë²„ê°€ í•„ìš”í•©ë‹ˆë‹¤. íŒŒì¼ ì´ë¦„: ${file}');">ğŸ“ ${file}</a></li>`).join('')}
                            </ul>
                            ` :
                            '';
                        modalDetails.innerHTML = `
                            <p class="text-gray-500 text-sm mb-1">ê³ ê°ì‚¬ëª…: <span class="text-gray-800 font-semibold">${data.clientName}</span></p>
                            <p class="text-gray-500 text-sm mb-1">ë‹´ë‹¹ì: <span class="text-gray-800 font-semibold">${data.contactName}</span></p>
                            <p class="text-gray-500 text-sm mb-1">ì‘ì„±ì: <span class="text-gray-800 font-semibold">${data.authorName || 'ë¯¸ìƒ'}</span></p>
                            <p class="text-gray-500 text-sm mb-1">ì‘ì„±ì¼: <span class="text-gray-800 font-semibold">${new Date(data.timestamp).toLocaleDateString() || 'ë¯¸ìƒ'}</span></p>
                            <p class="text-gray-500 text-sm mb-1">ë¯¸íŒ… ë‚ ì§œ: <span class="text-gray-800 font-semibold">${data.meetingDate || 'ë¯¸ìƒ'}</span></p>
                            <p class="text-gray-500 text-sm mb-1">ì˜ì—… ë‹¨ê³„: <span class="text-gray-800 font-semibold">${data.salesStage || 'ë¯¸ìƒ'}</span></p>
                            <p class="text-gray-500 text-sm mb-1">ì›í•˜ëŠ” ì‹œìŠ¤í…œ: <span class="text-gray-800 font-semibold">${data.desiredSystem || 'ë¯¸ìƒ'}</span></p>
                            <p class="text-gray-500 text-sm mb-1">ë„ì… ì‹œì : <span class="text-gray-800 font-semibold">${data.implementationTimeline || 'ë¯¸ìƒ'}</span></p>
                            <p class="text-gray-500 text-sm mb-1">ì˜ì‚¬ê²°ì • ë°©ì‹: <span class="text-gray-800 font-semibold">${data.decisionMethod || 'ë¯¸ìƒ'}</span></p>
                            <p class="text-gray-500 text-sm mb-1">ë¯¸íŒ… ë¶„ìœ„ê¸°: <span class="text-gray-800 font-semibold">${data.meetingMood?.join(', ') || 'ë¯¸ìƒ'}</span></p>
                            <h4 class="font-bold text-gray-700 mb-2 mt-4">í•µì‹¬ ì§ˆë¬¸ ê¸°ë¡</h4>
                            <p class="whitespace-pre-wrap">${data.keyQuestions || 'ì—†ìŒ'}</p>
                            <h4 class="font-bold text-gray-700 mb-2 mt-4">ê³ ê°ì˜ Pain Point</h4>
                            <p class="whitespace-pre-wrap">${data.painPoint || 'ì—†ìŒ'}</p>
                            <h4 class="font-bold text-gray-700 mb-2 mt-4">ê³ ê°ì˜ Needs & Goals</h4>
                            <p class="whitespace-pre-wrap">${data.needs || 'ì—†ìŒ'}</p>
                            <h4 class="font-bold text-gray-700 mb-2 mt-4">ì£¼ìš” ì œì•ˆ ë‚´ìš© ë° í˜‘ìƒ</h4>
                            <p class="whitespace-pre-wrap">${data.proposalDetails || 'ì—†ìŒ'}</p>
                            <h4 class="font-bold text-gray-700 mb-2 mt-4">ê³ ê°ì˜ ì£¼ìš” ë°˜ëŒ€ ì˜ê²¬</h4>
                            <p class="whitespace-pre-wrap">${data.customerObjections || 'ì—†ìŒ'}</p>
                            <h4 class="font-bold text-gray-700 mb-2 mt-4">ê³„ì•½ ê²°ê³¼ ë° ìš”ì¸</h4>
                            <p class="whitespace-pre-wrap">${data.closingOutcome || 'ì—†ìŒ'}</p>
                            <h4 class="font-bold text-gray-700 mb-2 mt-4">ê²½ìŸì‚¬ ì–¸ê¸‰</h4>
                            <p class="whitespace-pre-wrap">${data.competitor || 'ì—†ìŒ'}</p>
                            <h4 class="font-bold text-gray-700 mb-2 mt-4">ë‹¤ìŒ í–‰ë™ ê³„íš</h4>
                            <p class="whitespace-pre-wrap">${data.nextAction || 'ì—†ìŒ'}</p>
                            <h4 class="font-bold text-gray-700 mb-2 mt-4">ì¶”ê°€ ì •ë³´ / ììœ  ë©”ëª¨</h4>
                            <p class="whitespace-pre-wrap">${data.additionalNotes || 'ì—†ìŒ'}</p>
                            ${attachmentsHtml}
                        `;
                    } else if (type === 'brainstorming') {
                        modalTitle.innerText = `ë¸Œë ˆì¸ìŠ¤í† ë°: ${data.clientName}`;
                        modalDetails.innerHTML = `
                            <p class="text-gray-500 text-sm mb-1">ê³ ê°ì‚¬ëª…: <span class="text-gray-800 font-semibold">${data.clientName}</span></p>
                            <p class="text-gray-500 text-sm mb-1">ì‘ì„±ì¼: <span class="text-gray-800 font-semibold">${new Date(data.timestamp).toLocaleDateString() || 'ë¯¸ìƒ'}</span></p>
                            <hr class="my-4">
                            <h4 class="font-bold text-gray-700 mb-2">ë¬¸ì œ ì •ì˜ & í•µì‹¬ ì§ˆë¬¸</h4>
                            <p class="whitespace-pre-wrap">${data.problemDefine || 'ì—†ìŒ'}</p>
                            <h4 class="font-bold text-gray-700 mb-2 mt-4">ì•„ì´ë””ì–´ ë°œì‚°</h4>
                            <p class="whitespace-pre-wrap">${data.ideas || 'ì—†ìŒ'}</p>
                            <h4 class="font-bold text-gray-700 mb-2 mt-4">SWOT ë¶„ì„</h4>
                            <p class="text-gray-800 font-semibold">ê°•ì : <span class="font-normal">${data.swotS || 'ì—†ìŒ'}</span></p>
                            <p class="text-gray-800 font-semibold">ì•½ì : <span class="font-normal">${data.swotW || 'ì—†ìŒ'}</span></p>
                            <p class="text-gray-800 font-semibold">ê¸°íšŒ: <span class="font-normal">${data.swotO || 'ì—†ìŒ'}</span></p>
                            <p class="text-gray-800 font-semibold">ìœ„í˜‘: <span class="font-normal">${data.swotT || 'ì—†ìŒ'}</span></p>
                        `;
                    } else if (type === 'crm') {
                        modalTitle.innerText = `ê³ ê° ê´€ê³„ë„: ${data.clientName}`;
                        modalDetails.innerHTML = `
                            <p class="text-gray-500 text-sm mb-1">ê³ ê°ì‚¬ëª…: <span class="text-gray-800 font-semibold">${data.clientName}</span></p>
                            <p class="text-gray-500 text-sm mb-1">ì‘ì„±ì¼: <span class="text-gray-800 font-semibold">${new Date(data.timestamp).toLocaleDateString() || 'ë¯¸ìƒ'}</span></p>
                            <hr class="my-4">
                            <h4 class="font-bold text-gray-700 mb-2">ì¸ë¬¼ ì •ë³´</h4>
                            <ul class="list-disc list-inside space-y-2">
                                ${data.people.map(p => `<li><span class="font-semibold">${p.name || 'ë¯¸ìƒ'} (${p.title || 'ë¯¸ìƒ'}):</span> ${p.role || 'ì—­í•  ì •ë³´ ì—†ìŒ'}</li>`).join('')}
                            </ul>
                        `;
                    } else if (type === 'analysis') {
                        modalTitle.innerText = `ë¶„ì„: ${data.clientName}`;
                        modalDetails.innerHTML = `
                            <p class="text-gray-500 text-sm mb-1">ê³ ê°ì‚¬ëª…: <span class="text-gray-800 font-semibold">${data.clientName}</span></p>
                            <p class="text-gray-500 text-sm mb-1">ì‘ì„±ì¼: <span class="text-gray-800 font-semibold">${new Date(data.timestamp).toLocaleDateString() || 'ë¯¸ìƒ'}</span></p>
                            <p class="text-gray-500 text-sm mb-1">ìœ í˜•: <span class="text-gray-800 font-semibold">${data.caseType || 'ë¯¸ìƒ'}</span></p>
                            <hr class="my-4">
                            <h4 class="font-bold text-gray-700 mb-2">ì‚¬ë¡€ ìš”ì•½</h4>
                            <p class="whitespace-pre-wrap">${data.caseSummary || 'ì—†ìŒ'}</p>
                            <h4 class="font-bold text-gray-700 mb-2 mt-4">í•µì‹¬ ì›ì¸ ë¶„ì„</h4>
                            <p class="text-gray-800 font-semibold">ë‚˜ì˜ í–‰ë™: <span class="font-normal whitespace-pre-wrap">${data.myAction || 'ì—†ìŒ'}</span></p>
                            <p class="text-gray-800 font-semibold">ê³ ê° ì¸¡ ìš”ì¸: <span class="font-normal whitespace-pre-wrap">${data.customerSide || 'ì—†ìŒ'}</span></p>
                            <h4 class="font-bold text-gray-700 mb-2 mt-4">ì–»ì€ ì¸ì‚¬ì´íŠ¸</h4>
                            <p class="whitespace-pre-wrap">${data.insight || 'ì—†ìŒ'}</p>
                        `;
                    }
                    viewModal.classList.remove('hidden');
                }
            }

            window.closeModal = () => {
                viewModal.classList.add('hidden');
            };

            // ì´ˆê¸° ë¡œë“œ ì‹œ ë¯¸íŒ… ê¸°ë¡ ëª©ë¡ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
            loadRecordsList('meeting');
            
            // ROI ê³„ì‚°ê¸° ë¡œì§
            const roiSolutionSelect = document.getElementById('roi-solution-select');
            const roiInputsContainer = document.getElementById('roi-inputs');
            const roiPeriodInput = document.getElementById('roi-period-input');
            const roiResults = document.getElementById('roi-results');
            const calculateRoiBtn = document.getElementById('calculate-roi-btn');
            const roiResetBtn = document.getElementById('roi-reset-btn');
            const roiPeriodText = document.getElementById('roi-period-text');
            const paybackPeriodEl = document.getElementById('payback-period');
            const roiCostEl = document.getElementById('roi-cost');
            const annualSavingsEl = document.getElementById('annual-savings');
            
            roiSolutionSelect.addEventListener('change', (e) => {
                const solution = e.target.value;
                roiInputsContainer.innerHTML = '';
                if (solution) {
                    roiData[solution].forEach(item => {
                        const div = document.createElement('div');
                        div.className = 'roi-input-field';
                        div.innerHTML = `
                            <label for="${item.key}">${item.label}</label>
                            <input type="${item.type}" id="${item.key}" value="${item.value}" class="block w-full text-lg rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 mt-1">
                        `;
                        roiInputsContainer.appendChild(div);
                    });
                    roiInputsContainer.classList.remove('hidden');
                    roiPeriodInput.classList.remove('hidden');
                } else {
                    roiInputsContainer.classList.add('hidden');
                    roiPeriodInput.classList.add('hidden');
                }
                roiResults.classList.add('hidden'); // ì†”ë£¨ì…˜ ë³€ê²½ ì‹œ ê²°ê³¼ ìˆ¨ê¸°ê¸°
            });

            calculateRoiBtn.addEventListener('click', () => {
                const solution = roiSolutionSelect.value;
                if (!solution) {
                    alert("ì†”ë£¨ì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
                    return;
                }

                const period = parseInt(document.getElementById('calculation-period').value);
                if (isNaN(period) || period < 1 || period > 10) {
                    alert("ê³„ì‚° ê¸°ê°„ì€ 1ë…„ì—ì„œ 10ë…„ ì‚¬ì´ì˜ ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                    return;
                }

                let annualSavings = 0;
                let initialCost = 0;
                let annualMaintenanceCost = 0;

                const inputValues = {};
                roiData[solution].forEach(item => {
                    inputValues[item.key] = parseFloat(document.getElementById(item.key).value);
                });

                initialCost = inputValues.solutionCost;
                annualMaintenanceCost = inputValues.maintenanceCost || 0;


                if (solution === "MES") {
                    annualSavings = (inputValues.monthlyProduction * inputValues.unitCost * (inputValues.efficiency / 100)) * 12;
                } else if (solution === "EES") {
                    annualSavings = (inputValues.monthlyUptime * (inputValues.uptime / 100)) * inputValues.hourlyProduction * inputValues.unitProfit * 12;
                } else if (solution === "EMS") {
                    annualSavings = inputValues.annualMaintenanceCost * (inputValues.maintenanceSavings / 100);
                } else if (solution === "EAP") {
                    annualSavings = inputValues.annualTcCost * (inputValues.tcImprovement / 100);
                }
                
                const cumulativeSavings = [];
                const cumulativeCost = [];
                const cumulativeRoi = [];
                let paybackPeriod = "ê³„ì‚° ë¶ˆê°€";
                
                let currentTotalCost = 0;
                let currentTotalSavings = 0;
                let paybackFound = false;

                for (let i = 1; i <= period; i++) {
                    // ì²« í•´ì—ë§Œ ì´ˆê¸° ë„ì… ë¹„ìš©ì„ í¬í•¨
                    currentTotalCost = initialCost + (annualMaintenanceCost * i);
                    currentTotalSavings = annualSavings * i;
                    
                    cumulativeCost.push(currentTotalCost);
                    cumulativeSavings.push(currentTotalSavings);
                    
                    const currentRoi = ((currentTotalSavings - currentTotalCost) / currentTotalCost) * 100;
                    cumulativeRoi.push(currentRoi);
                    
                    if (currentTotalSavings >= currentTotalCost && !paybackFound) {
                        const monthsToPayback = (initialCost / (annualSavings - annualMaintenanceCost)) * 12;
                        const years = Math.floor(monthsToPayback / 12);
                        const months = Math.round(monthsToPayback % 12);
                        paybackPeriod = years > 0 ? `${years}ë…„ ${months}ê°œì›”` : `${months}ê°œì›”`;
                        paybackFound = true;
                    }
                }

                if (annualSavings <= annualMaintenanceCost) {
                    paybackPeriod = "íˆ¬ìê¸ˆ íšŒìˆ˜ ë¶ˆê°€ëŠ¥";
                }
                
                const finalRoiValue = cumulativeRoi[period - 1] || 0;
                const finalCost = cumulativeCost[period-1] || 0;
                
                roiCostEl.innerText = `${finalCost.toLocaleString()}ì›`;
                annualSavingsEl.innerText = `${annualSavings.toLocaleString()}ì›`;
                roiPeriodText.innerText = `${period}ë…„`;
                document.getElementById('final-roi').innerText = `${finalRoiValue.toFixed(2)}%`;
                paybackPeriodEl.innerText = paybackPeriod;
                
                roiResults.classList.remove('hidden');
                drawRoiChart(cumulativeSavings, cumulativeCost, period);
            });
            
            roiResetBtn.addEventListener('click', () => {
                roiSolutionSelect.value = '';
                roiInputsContainer.innerHTML = '';
                roiInputsContainer.classList.add('hidden');
                roiPeriodInput.classList.add('hidden');
                roiResults.classList.add('hidden');
            });
            
            function drawRoiChart(cumulativeSavings, cumulativeCost, period) {
                const ctx = document.getElementById('roiChart').getContext('2d');
                if (roiChart) {
                    roiChart.destroy(); // ê¸°ì¡´ ì°¨íŠ¸ê°€ ìˆìœ¼ë©´ ì‚­ì œ
                }
                
                const years = Array.from({ length: period }, (_, i) => `${i + 1}ë…„`);

                roiChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: years,
                        datasets: [
                            {
                                label: 'ëˆ„ì  íˆ¬ì ë¹„ìš©',
                                data: cumulativeCost,
                                borderColor: 'rgba(255, 99, 132, 1)',
                                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                borderWidth: 2,
                                fill: false,
                                pointRadius: 5,
                                pointHoverRadius: 8,
                            },
                            {
                                label: 'ëˆ„ì  ì ˆê° íš¨ê³¼',
                                data: cumulativeSavings,
                                borderColor: 'rgba(75, 192, 192, 1)',
                                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.4,
                                pointRadius: 5,
                                pointHoverRadius: 8,
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true
                            },
                            title: {
                                display: true,
                                text: 'ì—°ë„ë³„ íˆ¬ìê¸ˆ íšŒìˆ˜ ë¶„ì„',
                                font: { size: 18 }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString() + 'ì›';
                                    }
                                }
                            }
                        }
                    }
                });
            }

        });
    </script>
</body>
</html>
